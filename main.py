import logging
import os
from telegram.ext import Application, CommandHandler
from dotenv import load_dotenv
from scheduler import start_scheduler

# â”€â”€ Load .env â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
load_dotenv()
BOT_TOKEN = os.getenv("BOT_TOKEN")

# â”€â”€ Logging â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
logging.basicConfig(
    format="%(asctime)s - %(name)s - %(levelname)s - %(message)s",
    level=logging.INFO,
    handlers=[
        logging.FileHandler("bot.log", encoding="utf-8"),
        logging.StreamHandler()
    ]
)

# â”€â”€ /start command â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async def start(update, context):
    await update.message.reply_text("ğŸ¤– Ğ‘Ğ¾Ñ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚. Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ!")

# â”€â”€ Init & Start bot properly â”€â”€â”€â”€â”€â”€
application = Application.builder().token(BOT_TOKEN).build()
application.add_handler(CommandHandler("start", start))

# ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸Ğº Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ÑÑ ÑÑ€Ğ°Ğ·Ñƒ
start_scheduler()

# Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ² Ñ„Ğ¾Ğ½Ğ¾Ğ²Ğ¾Ğ¼ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ Ğ±ĞµĞ· run_polling()
async def run():
    await application.initialize()
    await application.start()
    await application.updater.start_polling()
    # updater.idle() Ğ½Ğµ Ğ½ÑƒĞ¶ĞµĞ½ Ğ½Ğ° Railway

import asyncio
asyncio.get_event_loop().create_task(run())
